<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="/static/img/logo/favicon.ico">
    <link rel="apple-touch-icon" href="/static/img/logo/apple-touch-icon.png">
    <link rel="icon" href="/static/img/logo/favicon.ico" sizes="48x48">
    <link rel="icon" href="/static/img/logo/favicon.svg" sizes="any" type="image/svg+xml">
    <title> 大数据后台 </title>

    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css"
          href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700"/>

    <!-- Font Awesome Icons -->
    <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

    <!-- CSS Files -->
    <link id="pagestyle" href="/static/css/material-dashboard.css?v=3.1.0" rel="stylesheet"/>
</head>
<body class="g-sidenav-show  bg-gray-100">


<aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3   bg-gradient-dark"
       id="sidenav-main">

    <div class="sidenav-header">
        <i class="fas fa-times p-3 cursor-pointer text-white opacity-5 position-absolute end-0 top-0 d-none d-xl-none"
           aria-hidden="true" id="iconSidenav"></i>
        <a class="navbar-brand m-0" href="/"
           target="_blank">
            <img src="/static/img/logo/favicon.ico" class="navbar-brand-img h-100" alt="main_logo">
            <span class="ms-1 font-weight-bold text-white">大数据后台</span>
        </a>
    </div>


    <hr class="horizontal light mt-0 mb-2">

    <div class="collapse navbar-collapse  w-auto " id="sidenav-collapse-main">
        <ul class="navbar-nav">

            <li class="nav-item">
                <a class="nav-link text-white" href="/">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">home</i>
                    </div>
                    <span class="nav-link-text ms-1">主页</span>
                </a>
            </li>

            <li class="dropdown">
                <a class="nav-link dropdown-toggle" data-bs-toggle="collapse" href="#showmenu">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">table_view</i>
                    </div>

                    <span class="nav-link-text ms-1">数据</span>
                </a>
                <div class="collapse show" id="showmenu">
                    <ul class="navbar-nav ms-5">
                        <li class="nav-item w-80">
                            <a class="nav-link nav-item text-white" href="/spider">
                                <span class="nav-link-text ms-1">爬取</span>
                            </a>
                        </li>
                        <li class="nav-item w-80">
                            <a class="nav-link nav-item text-white" href="/clean">
                                <span class="nav-link-text ms-1">清洗</span>
                            </a>
                        </li>
                        <li class="nav-item w-80 show">
                            <a class="nav-link nav-item text-white active bg-gradient-primary" href="/show">
                                <span class="nav-link-text ms-1">预览</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="/analysis">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">query_stats</i>
                    </div>
                    <span class="nav-link-text ms-1">可视化与分析</span>
                </a>
            </li>
        </ul>
    </div>
</aside>

<main class="main-content border-radius-lg ">
    <!-- Navbar -->

    <nav class="navbar navbar-main navbar-expand-lg mx-4 shadow-none border-radius-xl" id="navbarBlur"
         data-scroll="true">
        <div class="container-fluid py-1 px-3">
            <nav aria-label="breadcrumb">

                <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
                    <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="javascript:;">功能</a>
                    </li>
                    <li class="breadcrumb-item text-sm text-dark active" aria-current="page">数据</li>
                </ol>
                <h6 class="font-weight-bolder mb-0">预览</h6>

            </nav>
            <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
                <div class="ms-md-auto pe-md-3 d-flex align-items-center">

                    <div class="input-group input-group-outline">
                        <input type="text" id="search" class="form-control" placeholder="输入搜索关键词...">
                    </div>

                </div>
                <ul class="navbar-nav d-flex align-items-center">
                    <li class="mt-2">
                        <a class="github-button" href="https://github.com/isixe/JobAnalysis"
                           data-icon="octicon-star" data-size="large" data-show-count="true"
                           aria-label="Star isixe/JobAnalysis on GitHub">Star</a>
                    </li>
                    <li>
                        <div class="dropdown ms-3">
                            <i class="fa fa-user me-sm-1"></i>

                            <a href="#" class="dropdown-toggle " data-bs-toggle="dropdown"
                               id="navbarDropdownMenuLink2">
                                username
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink2">
                                <li>
                                    <span class="dropdown-item" onclick="logout()">
                                        注销
                                    </span>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <li class="nav-item px-3 d-flex align-items-center">
                        <a href="javascript:;" class="nav-link text-body p-0">
                            <i class="fa fa-cog fixed-plugin-button-nav cursor-pointer"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- End Navbar -->

    <div class="container-fluid">
        <div class="main-content">
            <div class="row">
                <div class="col-12">
                    <div class="row my-4">
                        <div class="text-start col-6">
                            <div class="row ms-2">
                                <select class="form-select ps-2 pe-2 w-25 p-1 border-primary text-primary font-weight-bold"
                                        id="data-name" name="data-name">
                                    <option value="51job">前程无忧</option>
                                </select>
                                <select class="form-select ps-2 pe-2 ms-2 w-20 p-1 border-primary text-primary font-weight-bold"
                                        id="data-source" name="data-source">
                                    <option value="csv">CSV</option>
                                    <option value="db">SQLite</option>
                                </select>
                            </div>
                        </div>
                        <div class="text-end col-6">
                            <button class="btn btn-outline-primary btn-sm mb-0 me-2" data-bs-toggle="modal"
                                    data-bs-target="#importModal">导入
                            </button>
                            <button class="btn btn-outline-primary btn-sm mb-0" data-bs-toggle="modal"
                                    data-bs-target="#exportModal">导出
                            </button>

                            <!-- Modal -->
                            <div class="modal fade" id="importModal" tabindex="-1" role="dialog"
                                 aria-labelledby="importModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title font-weight-normal" id="importModalLabel">
                                                请选择导入的文件</h5>
                                            <button type="button" class="btn-close text-dark" data-bs-dismiss="modal"
                                                    aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row mx-3">
                                                <input type="file" id="import" name="import"
                                                       class="mb-2 bg-dark p-2 text-white text-sm border-1 border-radius-md"
                                                       accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
                                                       placeholder="支持csv、excel格式文件">
                                                <span class="text-secondary text-opacity-50 text-start text-xs">
                                                <i class="fa fa-volume-down"></i>
                                                支持csv、excel格式文件
                                            </span>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn bg-gradient-secondary"
                                                    data-bs-dismiss="modal">
                                                关闭
                                            </button>
                                            <button type="button" class="btn bg-gradient-primary"
                                                    onclick="fileUpLoad()">
                                                导入
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modal fade" id="exportModal" tabindex="-1" role="dialog"
                                 aria-labelledby="exportModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title font-weight-normal" id="exportModalLabel">
                                                请选择导出的文件类型</h5>
                                            <button type="button" class="btn-close text-dark" data-bs-dismiss="modal"
                                                    aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <select class="form-select ps-2 pe-2 p-1 border-warning text-warning font-weight-bold"
                                                    id="data-type" name="data-type">
                                                <option value="csv">CSV</option>
                                                <option value="excel">EXCEL</option>
                                            </select>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn bg-gradient-secondary"
                                                    data-bs-dismiss="modal">
                                                关闭
                                            </button>
                                            <button type="button" class="btn bg-gradient-primary"
                                                    onclick="exportByType()">
                                                导出
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12">
                    <div class="card my-2">
                        <div class="card-body px-0 pb-2">
                            <div class="table-responsive p-0">
                                <table class="table align-items-center mb-0 table-sort" id="jobtable">
                                    <thead>
                                    <tr>
                                        <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-8">
                                            Logo
                                        </th>
                                        <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-8 ps-2">
                                            工作名称 <i class="fas fa-caret-down"></i>
                                        </th>
                                        <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-8">
                                            地点 <i class="fas fa-caret-down"></i>
                                        </th>
                                        <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-8">
                                            最低薪资 <i class="fas fa-caret-down"></i>
                                        </th>
                                        <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-8">
                                            最高薪资 <i class="fas fa-caret-down"></i>
                                        </th>
                                        <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-8">
                                            工作年限 <i class="fas fa-caret-down"></i>
                                        </th>
                                        <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-8">
                                            学历要求 <i class="fas fa-caret-down"></i>
                                        </th>
                                        <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-8">
                                            标签 <i class="fas fa-caret-down"></i>
                                        </th>
                                        <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-8">
                                            公司名称 <i class="fas fa-caret-down"></i>
                                        </th>
                                        <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-8">
                                            公司类型 <i class="fas fa-caret-down"></i>
                                        </th>
                                        <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-8">
                                            规模 <i class="fas fa-caret-down"></i>
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody id="jobList"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-6">
                    <span class="text-secondary text-xs ms-1 mt-2">总数据量: <span id="total_count">NaN</span></span>

                </div>
                <div class="col-6">
                    <button class="btn btn-outline-primary btn-sm mb-0 me-2 position-absolute end-1"
                            onclick="dataDelete()">
                        清空
                    </button>
                </div>
                <ul class="pagination d-flex justify-content-center">
                    <li class="page-item disabled" id="prev">
                        <a class="page-link" href="javascript:;">
                            <span class="material-icons">
                              keyboard_arrow_left
                            </span>
                            <span class="sr-only">Previous</span>
                        </a>
                    </li>
                    <li class="page-item active"><a class="page-link text-white" href="javascript:;">1</a></li>
                    <li class="page-item disabled" id="next">
                        <a class="page-link" href="javascript:;">
                        <span class="material-icons">
                          keyboard_arrow_right
                        </span>
                            <span class="sr-only">Next</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <footer class="footer py-4  ">
        <div class="container-fluid">
            <div class="row align-items-center justify-content-lg-between">
                <div class="col-lg-6 mb-lg-0 mb-4">
                    <div class="copyright text-center text-sm text-muted text-lg-start">
                        ©
                        <script>
                            document.write(new Date().getFullYear())
                        </script>
                        ,
                        made with <i class="fa fa-heart"></i> by
                        <a href="https://github.com/isixe" class="font-weight-bold text-black-50"
                           target="_blank">isixe</a>
                        for a better job analysis.
                    </div>
                </div>
                <div class="col-lg-6">
                    <ul class="nav nav-footer justify-content-center justify-content-lg-end">
                        <li class="nav-item">
                            <a href="https://github.com/isixe" class="nav-link text-black-50"
                               target="_blank">isixe</a>
                        </li>
                        <!--                            <li class="nav-item">-->
                        <!--                                <a href="https://www.creative-tim.com/blog" class="nav-link text-muted" target="_blank">Blog</a>-->
                        <!--                            </li>-->
                        <li class="nav-item">
                            <a href="https://www.creative-tim.com/license" class="nav-link pe-0 text-muted"
                               target="_blank">License</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

</main>


<div class="fixed-plugin">
    <a class="fixed-plugin-button text-dark position-fixed px-3 py-2">
        <i class="material-icons py-2">settings</i>
    </a>
    <div class="card shadow-lg">
        <div class="card-header pb-0 pt-3">
            <div class="float-start">
                <h5 class="mt-3 mb-0">Material UI Configurator</h5>
                <p>仪表板选项</p>
            </div>
            <div class="float-end mt-4">
                <button class="btn btn-link text-dark p-0 fixed-plugin-close-button">
                    <i class="material-icons">clear</i>
                </button>
            </div>
            <!-- End Toggle Button -->
        </div>
        <hr class="horizontal dark my-1">
        <div class="card-body pt-sm-3 pt-0">
            <!-- Sidebar Backgrounds -->
            <div>
                <h6 class="mb-0">侧边栏颜色</h6>
            </div>
            <a href="javascript:void(0)" class="switch-trigger background-color">
                <div class="badge-colors my-2 text-start">
                    <span class="badge filter bg-gradient-primary active" data-color="primary"
                          onclick="sidebarColor(this)"></span>
                    <span class="badge filter bg-gradient-dark" data-color="dark" onclick="sidebarColor(this)"></span>
                    <span class="badge filter bg-gradient-info" data-color="info" onclick="sidebarColor(this)"></span>
                    <span class="badge filter bg-gradient-success" data-color="success"
                          onclick="sidebarColor(this)"></span>
                    <span class="badge filter bg-gradient-warning" data-color="warning"
                          onclick="sidebarColor(this)"></span>
                    <span class="badge filter bg-gradient-danger" data-color="danger"
                          onclick="sidebarColor(this)"></span>
                </div>
            </a>

            <!-- Sidenav Type -->

            <div class="mt-3">
                <h6 class="mb-0">侧导航类型</h6>
                <p class="text-sm">在以下 2 种不同的侧导航类型之间进行选择。</p>
            </div>

            <div class="d-flex">
                <button class="btn bg-gradient-dark px-3 mb-2 active" data-class="bg-gradient-dark"
                        onclick="sidebarType(this)">Dark
                </button>
                <button class="btn bg-gradient-dark px-3 mb-2 ms-2" data-class="bg-transparent"
                        onclick="sidebarType(this)">Transparent
                </button>
                <button class="btn bg-gradient-dark px-3 mb-2 ms-2" data-class="bg-white" onclick="sidebarType(this)">
                    White
                </button>
            </div>

            <p class="text-sm d-xl-none d-block mt-2">You can change the sidenav type just on desktop view.</p>


            <!-- Navbar Fixed -->

            <div class="mt-3 d-flex">
                <h6 class="mb-0">导航栏固定</h6>
                <div class="form-check form-switch ps-0 ms-auto my-auto">
                    <input class="form-check-input mt-1 ms-auto" type="checkbox" id="navbarFixed"
                           onclick="navbarFixed(this)">
                </div>
            </div>


            <hr class="horizontal dark my-3">
            <div class="mt-2 d-flex">
                <h6 class="mb-0">明亮 / 黑暗</h6>
                <div class="form-check form-switch ps-0 ms-auto my-auto">
                    <input class="form-check-input mt-1 ms-auto" type="checkbox" id="dark-version"
                           onclick="darkMode(this)">
                </div>
            </div>
            <hr class="horizontal dark my-sm-4">


            <a class="btn bg-gradient-info w-100" href="https://www.creative-tim.com/product/material-dashboard-pro">免费下载</a>


            <a class="btn btn-outline-dark w-100"
               href="https://www.creative-tim.com/learning-lab/bootstrap/overview/material-dashboard">查看文档</a>

            <div class="w-100 text-center">
                <a class="github-button" href="https://github.com/creativetimofficial/material-dashboard"
                   data-icon="octicon-star" data-size="large" data-show-count="true"
                   aria-label="Star creativetimofficial/material-dashboard on GitHub">Star</a>
                <h6 class="mt-3">Thank you for sharing!</h6>

                <a href="https://twitter.com/intent/tweet?text=Check%20Material%20UI%20Dashboard%20made%20by%20%40CreativeTim%20%23webdesign%20%23dashboard%20%23bootstrap5&amp;url=https%3A%2F%2Fwww.creative-tim.com%2Fproduct%2Fsoft-ui-dashboard"
                   class="btn btn-dark mb-0 me-2" target="_blank">
                    <i class="fab fa-twitter me-1" aria-hidden="true"></i> Tweet
                </a>


                <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.creative-tim.com/product/material-dashboard"
                   class="btn btn-dark mb-0 me-2" target="_blank">
                    <i class="fab fa-facebook-square me-1" aria-hidden="true"></i> Share
                </a>
            </div>
        </div>
    </div>
</div>

<!--   Core JS Files   -->
<script src="/static/js/core/popper.min.js"></script>
<script src="/static/js/core/bootstrap.min.js"></script>

<!--   Plugins JS Files   -->
<script src="/static/js/plugins/perfect-scrollbar.min.js"></script>
<script src="/static/js/plugins/sweetalert2@11.js"></script>
<script src="/static/js/plugins/table-sort.js"></script>

<script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
        var options = {
            damping: '0.5'
        }
        Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }

    document.addEventListener("DOMContentLoaded", function () {

        const check = document.getElementById('dark-version');
        const barfixed = document.getElementById('navbarFixed');
        barfixed.click();

        check.addEventListener('click', (e) => {
            if (check.checked) {
                localStorage.setItem('dark', 'true');
            } else {
                localStorage.setItem('dark', 'false');
            }
        });
        if (localStorage.getItem('dark') === 'true') {
            check.click();
            darkMode();
        }

        barfixed.addEventListener('click', (e) => {
            if (barfixed.checked) {
                localStorage.setItem('barfixed', 'true');
            } else {
                localStorage.setItem('barfixed', 'false');
            }
        });
        if (localStorage.getItem('barfixed') === 'true') {
            barfixed.click();
        }
    });
</script>


<!-- Setting Toast by sweetalert -->
<script>
    const Toast = Swal.mixin({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
        }
    });
</script>

<!-- Keyword earch -->
<script>
    ;(() => {
        document.getElementById('search').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const search = document.getElementById('search');
                const keyword = search.value;
                let url = new URL(window.location.href);
                let params = url.searchParams;
                params.set('keyword', keyword);
                window.location.href = url.toString();
            }
        });
    })();
</script>

<!-- Table sort icon -->
<script>
    ;(() => {
        const table = document.getElementById('jobtable');
        table.addEventListener('click', (e) => {
            const target = e.target;
            if (target.tagName === 'TH') {
                const icon = target.querySelector('i');
                const icons = table.querySelectorAll('th i');

                if (icon.classList.contains('fa-caret-down')) {
                    icons.forEach(icon => {
                        icon.classList.remove('fa-caret-up');
                        icon.classList.add('fa-caret-down');
                    });
                    icon.classList.remove('fa-caret-down');
                    icon.classList.add('fa-caret-up');
                    return;
                }

                if (icon.classList.contains('fa-caret-up')) {
                    icon.classList.remove('fa-caret-up');
                    icon.classList.add('fa-caret-down');
                }
            }
        });
    })();
</script>

<!-- Data loader -->
<script>
    ;(() => {
        let type = localStorage.getItem('datasource');
        const datasource = document.getElementById('data-source');
        let dataname = localStorage.getItem('dataname') == null ? '51job' : localStorage.getItem('dataname');

        if (type) {
            datasource.value = type;
        } else {
            datasource.value = 'csv';
            type = 'csv';
        }

        datasource.addEventListener('change', function () {
            localStorage.setItem('datasource', datasource.value);
            window.location.reload();
        });

        const paramsString = window.location.search
        const params = new URLSearchParams(paramsString);
        const pageNum = params.get('pageNum') == null ? '' : params.get('pageNum');
        const pageSize = params.get('pageSize') == null ? '' : params.get('pageSize');
        const keyword = params.get('keyword') == null ? '' : params.get('keyword');

        const fetchData = async () => {
            try {
                const url = `/api/jobs?name=${dataname}&type=${type}&pageNum=${pageNum}&pageSize=${pageSize}&keyword=${keyword}`;
                const response = await fetch(url, {
                    method: 'GET',
                });
                const result = await response.json();

                if (result.status === 1) {
                    return result.data;
                }

                if (result.status === 0) {
                    Toast.fire({
                        icon: 'error',
                        title: result.message,
                    });
                }
            } catch (error) {
                Toast.fire({
                    icon: 'error',
                    title: '网络错误，请稍后重试',
                });
            }
        };

        fetchData().then(data => {
            if (!data.list) {
                return;
            }
            const prevButton = document.querySelector('#prev');
            const nextButton = document.querySelector('#next');

            const urlBuilder = (pageNum, pageSize, keyword) => {
                let baseUrl = window.location.protocol + "//" + window.location.host;
                let url = new URL(baseUrl + '/show');
                let params = url.searchParams;
                params.append('name', dataname);
                params.append('pageNum', pageNum);
                params.append('pageSize', pageSize);
                if (keyword) {
                    params.append('keyword', keyword);
                }
                return url.toString();
            }

            if (data.prev) {
                prevButton.className = 'page-item';
                document.querySelector('#prev a').setAttribute('href', urlBuilder(data.prev, data.pageSize, keyword));
            }

            if (data.next) {
                nextButton.className = 'page-item';
                document.querySelector('#next a').setAttribute('href', urlBuilder(data.next, data.pageSize, keyword));
            }

            const paginationContainer = document.querySelector('.pagination');
            const pageItems = paginationContainer.querySelectorAll('.page-item:not(#prev):not(#next)');
            pageItems.forEach(item => item.remove());

            let createPageItem = (className, content) => {
                const pageItem = document.createElement('li');
                pageItem.className = 'page-item';
                pageItem.innerHTML = `<a class="page-link ${className}" href="${urlBuilder(content, data.pageSize, keyword)}">${content}</a>`;
                return pageItem;
            }

            if (data.totalSize <= 5) {
                for (let i = 0; i <= data.totalSize; i++) {
                    let pageItem = createPageItem('', i);

                    if (i === data.current) {
                        pageItem = createPageItem('text-white active', i);
                    }

                    paginationContainer.insertBefore(pageItem, nextButton);
                }
            }

            if (data.totalSize > 5) {
                const start = data.current - 1;
                const end = data.current + 2;

                for (let i = start; i <= end; i++) {

                    if (i > 0 && i < data.totalSize + 1) {
                        let pageItem = createPageItem('', i);

                        if (i === data.current) {
                            pageItem = createPageItem('text-white active', i);
                        }

                        paginationContainer.insertBefore(pageItem, nextButton);
                    }
                }


                if (data.current < Math.ceil(data.totalSize / 2)) {
                    const disabledPageItem = createPageItem('disabled', '...');
                    paginationContainer.insertBefore(disabledPageItem, nextButton);

                    const lastPageItem = createPageItem('', data.totalSize);
                    paginationContainer.insertBefore(lastPageItem, nextButton);
                } else {
                    const firstPageItem = createPageItem('', 1);
                    const disabledPageItem = createPageItem('disabled', '...');

                    paginationContainer.insertBefore(disabledPageItem, prevButton.nextSibling);
                    paginationContainer.insertBefore(firstPageItem, prevButton.nextSibling);
                }
            }

            document.getElementById('total_count').innerText = data.total;

            joblist = Array.from(data.list);
            joblist.forEach(item => {
                let table = document.getElementById('jobList');
                let data_col = document.createElement('tr');
                data_col.innerHTML = `<td>
                                <div class="d-flex px-2 py-1">
                                    <div>
                                        <img src="${item.logo}"
                                             class="avatar avatar-sm me-3 border-radius-lg" alt="user1">
                                    </div>
                                </div>
                                </td>
                                <td>
                                    <p class="text-xs font-weight-bold mb-0">${item.jobName}</p>
                                </td>
                                <td class="align-middle">
                                    <span class="text-secondary text-xs font-weight-bold">${item.area}</span>
                                </td>
                                <td class="align-middle text-center ">
                                    <span class="text-secondary text-xs font-weight-bold">${item.min_salary}</span>
                                </td>
                                <td class="align-middle text-center ">
                                    <span class="text-secondary text-xs font-weight-bold">${item.max_salary}</span>
                                </td>
                                <td class="align-middle text-center ">
                                    <span class="text-secondary text-xs font-weight-bold">${item.workYear}</span>
                                </td>
                                <td class="align-middle text-center ">
                                    <span class="text-secondary text-xs font-weight-bold">${item.degree}</span>
                                </td>
                                <td class="align-middle text-start text-sm">
                                  ${item.tags.split(',').map(tag => `<span class="badge badge-xxs ms-1 bg-gradient-success">${tag}</span>`).join('')}
                                </td>
                                <td class="align-middle text-center">
                                    <span class="text-secondary text-xs font-weight-bold">${item.companyName}</span>
                                </td>
                                <td class="align-middle text-center">
                                    <span class="text-secondary text-xs font-weight-bold">${item.companyType}</span>
                                </td>
                                <td class="align-middle text-center">
                                    <span class="text-secondary text-xs font-weight-bold">${item.companySize}</span>
                                </td>`;
                table.appendChild(data_col);
            });
        });
    })();
</script>

<!-- Data remove -->
<script>
    const dataDelete = (e) => {
        Swal.fire({
            title: '确定要删除吗?',
            text: "数据删除后将无法恢复！",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#1e88e5',
            cancelButtonColor: '#dd2c00',
            confirmButtonText: '确定',
            cancelButtonText: '取消'
        }).then((result) => {

            if (result.isDismissed) {
                return;
            }

            let dataname = localStorage.getItem('dataname') == null ? '51job' : localStorage.getItem('dataname');
            const source = localStorage.getItem('datasource');

            fetch('/api/jobs', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({name: dataname, source: source})
            }).then((response) => response.json())
                .then((result) => {
                    if (result.status === 1) {
                        Swal.fire(
                            '删除成功!',
                            '数据已经删除，即将刷新',
                            'success'
                        );

                        setTimeout(() => {
                            window.location.reload();
                        }, 1500);
                    }
                    if (result.status === 0) {
                        Swal.fire(
                            '删除失败!',
                            '数据未删除，即将刷新',
                            'error'
                        );
                    }
                })
                .catch((error) => {
                    Toast.fire({
                        icon: 'error',
                        title: '网络错误，请稍后重试'
                    });
                });
        });
    };
</script>

<!-- Data export -->
<script>
    const exportByType = async () => {
        const source = localStorage.getItem('datasource');
        const type = document.getElementById('data-type').value;
        const paramsString = window.location.search
        const params = new URLSearchParams(paramsString);
        const keyword = params.get('keyword') == null ? '' : params.get('keyword');
        let dataname = localStorage.getItem('dataname') == null ? '51job' : localStorage.getItem('dataname');
        window.location.href = `/api/jobs/export?keyword=${keyword}&name=${dataname}&source=${source}&type=${type}`;
    };
</script>

<!-- Data import -->
<script>
    const fileUpLoad = () => {
        const formData = new FormData();
        const fileField = document.getElementById('import');
        const source = localStorage.getItem('datasource');
        let dataname = localStorage.getItem('dataname') == null ? '51job' : localStorage.getItem('dataname');

        formData.append("name", dataname);
        formData.append("type", fileField.files[0].type);
        formData.append("file", fileField.files[0]);
        formData.append('source', source);

        fetch('/api/jobs/import', {
            method: 'PUT',
            body: formData,
        }).then((response) => response.json())
            .then((result) => {
                if (result.status === 1) {
                    Toast.fire({
                        icon: 'success',
                        title: "导入成功"
                    });
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                }
                if (result.status === 0) {
                    Toast.fire({
                        icon: 'error',
                        title: result.message
                    });
                }
            })
            .catch((error) => {
                Toast.fire({
                    icon: 'error',
                    title: '网络错误，请稍后重试'
                });
            });
    };
</script>

<!-- Logout request -->
<script>
    const logout = () => {
        fetch('/api/logout', {
            method: 'POST',
        }).then(response => response.json())
            .then(result => {
                if (result.status === 1) {
                    Toast.fire({
                        icon: 'success',
                        title: result.message
                    });
                    setTimeout(() => {
                        window.location.href = window.location.origin;
                    }, 1500);
                }
            }).catch(error => {
            Toast.fire({
                icon: 'error',
                title: '网络错误，请稍后重试'
            });
        });
    }
</script>

<!-- User Setting -->
<script>
    ;(() => {
        document.getElementById('navbarDropdownMenuLink2').innerText = localStorage.getItem('user');
    })();
</script>

<!-- Github buttons -->
<script async defer src="https://buttons.github.io/buttons.js"></script>


<!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
<script src="/static/js/material-dashboard.min.js?v=3.1.0"></script>
</body>

</html>
